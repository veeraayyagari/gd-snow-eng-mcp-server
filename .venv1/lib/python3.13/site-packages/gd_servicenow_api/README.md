# Observability Lib for ServiceNow

This is a Python Library to interact and manage the ServiceNow database

## Installation

```sh
pip install gd_servicenow_api
```

## Usage

**Initialisation**

```sh
from gd_servicenow_api import observability_snow
service_now_client = observability_snow.ObservabilityServiceNow(username, password, client_id, client_secret, servicenow_api_url)
```
**Create Incident and update DNA form**

Example

```sh
incident = {
        "impact": 2,
        "priority": 3,
        "short_description": "[Test]Table SLA miss for sellbrite_cln.product_cln Tier 3",
        "correlation_display": "DnA Teams Intake",
        "made_sla": "false",
        "urgency": 2,
        "severity": 2,
        "category": "dna_incident",
        "u_issue_start": "2024-05-15 10:00:45",
        "description": "The table sellbrite_cln.product_cln missed its SLA. \nDetails:\nDatabase Name: sellbrite_cln\nTable Name: product_cln\nDelivery instance: {'year': '2024', 'month': '06', 'day': '06'}\nOriginal On-Call Group:DEV-Sellmore Horizontal",
        "assignment_group": "185ae321db8b409467eb5d30cf9619ab"
    }

dna_form =  {
        "impacted_data_set_tier": "tier3",
        "impact": 2,
        "data_producer_information": "dc-ucc-notifications",
        "email_address": "sellmore-horizontal@godaddy.com",
        "data_set_name": "sellbrite_cln.product_cln",
        "select_team": "commerce_data",
        "which_area_is_impacted": "Data Issue"
    }

cmdb_ci_id = {
    "name": "product_cln",
    "database": "sellbrite_cln",
    "db_class": "u_cmdb_ci_aws_data_lake"
}

payload = {
    'incident': incident,
    'dna_form': dna_form
}

result = service_now_client.create_incident_and_dna_form(payload.get("incident"), payload.get("dna_form"), 'DnA_Ops_Support_Group', cmdb_ci_id)
```

**Create Incident with CI (sys_id)**

```sh
message_json = {
        "impact": 2,
        "priority": 3,
        "short_description": "[Test]Table SLA miss for sellbrite_cln.product_cln Tier 3",
        "correlation_display": "DnA Teams Intake",
        "made_sla": "false",
        "urgency": 2,
        "severity": 2,
        "category": "dna_incident",
        "u_issue_start": "2024-05-15 10:00:45",
        "description": "The table sellbrite_cln.product_cln missed its SLA. \nDetails:\nDatabase Name: sellbrite_cln\nTable Name: product_cln\nDelivery instance: {'year': '2024', 'month': '06', 'day': '06'}\nOriginal On-Call Group:DEV-Sellmore Horizontal",
        "assignment_group": "185ae321db8b409467eb5d30cf9619ab"
    }

cmdb_ci_sys_id = "06c96b1fdbc81a10e804049ed3961915"

result = service_now_client.create_incident_with_ci(incident=message_json, assignment_group_name=None, cmdb_ci=cmdb_ci_sys_id)
```

**Get Incident**

```sh
result = service_now_client.get_incident(number="INCXXXXX")
```

**Incident State Change**

```sh
result = service_now_client.incident_change_state(sys_id, IncidentState.CANCELED)
```

**Assign Incident to team**

```sh
result = service_now_client.assign_incident_to(sys_id, assignment_group_name)
```

**Get table data**

```sh
result = service_now_client.get_table_with_offset(
            table: str, sys_id: str = None, name: str = None, rows: int = 10000, name_override: str = None, offset: int =0, extra_params: str = None
    )
```

**Create Change Request Ticket**
```shell
data = {
            "short_description": "testing change from new api",
            "description": "testing hgajiogj uhriwe eiru5392u ",
            "u_approval_group": "user-insights-platform",
            "assignment_group": "user-insights-platform",
            "backout_plan": "testing plan",
            "assigned_to": "sbhardwaj@godaddy.com",
            "u_jira_url": "https://godaddy-corp.atlassian.net/browse/ODP-486",
            "change_plan": "testing for deployment",
            "start_date": "2024-10-10 10:00:00",
            'u_critical_service_affected': 'Accounting',
            'risk': '4',
            'impact': '4',
            'end_date': "2024-10-31 12:00:00",
            'test_plan': "this is test plan"
        }
        result = service_now_client.create_change_request(data)
```